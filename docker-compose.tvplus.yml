# docker-compose.tvplus.yml
# TVPlus IPTV - n8n MCP Server (Docker Desktop)
#
# Uso:
#   cp .env.tvplus.example .env.tvplus
#   # Editar .env.tvplus con tu API key real
#   docker compose -f docker-compose.tvplus.yml --env-file .env.tvplus up -d
#
# Modo stdio (para Claude Code MCP):
#   Se configura en .claude/mcp.json, NO usa este compose.
#   Este compose es para el modo HTTP (API directa / healthcheck).

services:
  n8n-mcp:
    image: ghcr.io/renatoascencio/n8n-mcp:latest
    container_name: n8n-mcp-tvplus
    restart: unless-stopped

    environment:
      MCP_MODE: http
      AUTH_TOKEN: ${MCP_AUTH_TOKEN:?MCP_AUTH_TOKEN is required}
      N8N_API_URL: ${N8N_API_URL:?N8N_API_URL is required}
      N8N_API_KEY: ${N8N_API_KEY:?N8N_API_KEY is required}
      NODE_ENV: production
      LOG_LEVEL: ${LOG_LEVEL:-info}
      PORT: ${MCP_PORT:-3000}
      NODE_DB_PATH: /app/data/nodes.db
      REBUILD_ON_START: "false"

    ports:
      - "${MCP_PORT:-3000}:${MCP_PORT:-3000}"

    volumes:
      - n8n-mcp-tvplus-data:/app/data

    deploy:
      resources:
        limits:
          memory: 512M
        reservations:
          memory: 256M

    healthcheck:
      test: ["CMD", "sh", "-c", "curl -f http://127.0.0.1:$${MCP_PORT:-3000}/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s

volumes:
  n8n-mcp-tvplus-data:
    driver: local
